# 王道论坛 - 计算机网络

- [计算机网络体系结构](#计算机网络体系结构)
- [物理层](#物理层)
- [数据链路层](#数据链路层)
- [网络层](#网络层)
- [传输层](#传输层)
- [应用层](#应用层)


### 计算机网络体系结构

**概述:**

一般定义: 计算机网络是一个将分散的, 具有独立功能的计算机系统, 通过通信设备与线路连接起来, 由功能完善的软件实现资源共享和信息传递的系统.

三种观点: 广义观点, 资源共享观点, 用户透明性观点

从组成部分上看: 硬件, 软件, 协议三部分.

其中, 硬件主要由: 主机, 通信链路(双绞线, 光纤), 交换设备(如路由器, 交换机等)和通信处理机(如网卡)等组成; 软件主要包括实现资源共享的软件和方便用户使用的各种工具(如网络操作系统, 邮件收发程序, FTP程序, 聊天程序). 协议是计算机网络的核心.

从工作方式上: 计算机网络可分为边缘部分和核心部分, 核心部分由大量的网络和连接这些网络的路由器组成, 它为边缘部分提供连通性和交换服务.

从功能组成上看: 通信子网和资源子网组成.

**计算机网络的功能:** 

1. 数据通信
2. 资源共享
3. 分布式处理
4. 提高可靠性
5. 负载均衡

**计算机网络的分类**

- 分布范围分类

1. 广域网WAN(覆盖范围, 几十千米到几千千米, 任务为提供长距离的通信, 因特网的核心部分)
2. 城域网MAN(覆盖范围, 5~50千米 几个街区到整个城市)
3. 局域网LAN(覆盖范围, 几十米到几千米, 传统上, 局域网上使用广播技术, 广域网使用交换技术)
4. 个人区域网PAN(或WPAN, 覆盖范围10m)

- 按传输技术分类

1. 广播式网络

当一台计算机利用共享通信信道发送报文分组时, 所有其它的计算机都会"收听"到这个分组. 接收到的计算机通过检查目的地址来决定是否接收该分组. 如局域网, 广域网中无线, 卫星通信网络

2. 点对点网络

每条物理线路连接一对计算机, 若无直连线路, 那么它们间的分组传输就要通过蹭结点的接收, 存储和转发. (是否采用分组存储转发与路由机制是点对点式网络与广播式网络的重要区别), 广域网基本都是点对点网络.

- 按拓扑结构分类

网络结构是指由网中结点(路由器, 主机等)与通信线路(网络)之间的几何关系(如, 总线形, 环线形)表示的网络结构, 主要指通信子网的拓扑结构.

1. 星形网络

优: 便于集中控制管理; 缺: 成本高, 中心结点对故障敏感.

2. 总线形网络

优: 建网容易, 培养结点方便, 节省线路; 缺: 重负载时通信效率不高, 总线任意一处对故障敏感.

3. 环形网络

4. 网状形网络

规则型和非规则型2种, 优: 可靠性高; 缺: 控制复杂, 线路成本高.

- 按使用者分

1. 公用网
2. 专用网

- 按交换技术分类

1. 电路交换网络

在源结点与目的结点之间建立一条专用的通路用于传送数据, 包括建立连接, 传输数据, 断开连接三阶段, 如传统电话网络.

优: 数据直接传送, 时延小; 缺: 线路利用率低, 不能充分利用线路容量, 不便于差错控制.

2. 报文交换网络

用户数据加上源地址, 目的地址, 校验码等辅助信息, 然后封闭成报文. 报文传送到相邻结点, 全部存储后, 再发送给下一个结点, 重复直到目的地. 报文交换网络也称 **存储-转发网络**, 优: 较充分地利用线路容量, 可以实现不同线路间不同数据率的转换, 可以实现格式转换, 可以实现一对多, 多对一的访问, 可以实现差错控制; 缺: 增大的了资源开销(如辅助信息导致处理时间和存储资源的开销), 增加了时延, 需要额外的控制机制来保证多个报文的顺序不乱序, 缓冲区难以管理(因报文的大小不确定, 接收方无法在接收报文之前预知报文大小.)

3. 分组交换网络

也秒**包交换网络**, 其原理是将数据分成较短的固定长度的数据块, 在每个数据块中加上目的地址, 源地址等辅助信息组成分组(包)传送到相邻结点(再存储-转发...). 主要特点是单个分组(它只是整体报文的一部分), 优:  较充分地利用线路容量, 可以实现不同线路间不同数据率的转换, 可以实现格式转换, 可以实现一对多, 多对一的访问, 可以实现差错控制 + 缓冲易于管理, 包的平均时延更小, 网络占用的平均缓冲区更少, 更易于标准化, 更适合应用. **主流网络基本都可视为分组交换网络**

- 传输介质 

1. 有线(双绞线网络, 同轴电缆网络)
2. 无线(蓝牙, 微波, 无线电)

**标准化**

所有标准都支 RFC(Rekuest For Comments) 形式在因特网上分布, 但并非所有RFC都是标准. 标准化, 一般要经历4个阶段

1. Internet Draft
2. Proposed Standard 开始成为RFC
3. Draft Standard
4. Internet Standard

组织有 ISO, ITU(国际电信联盟), IEEE(国际电所电子工程师协会)

**网络性能指标**

1. 带宽(Bandwidth), 表示网络的通信线路所能传送数据的能力, 是数字信道所能传送的"最高数据率"的同义词, 单位是比特/秒(b/s).
2. 时延(Delay), 指数据(一个报文或分组)从网络(或链路)的一端传送到另一端所需要的总时间, 它由4部分组成, 发送时延 + 传播时延 + 处理时延 + 排队时延.
3. 时延带宽积
4. 往返时延(Round-Trip Time, RTT), 指从发送端发送数据开始, 到发送端收到来自接收端的确认(接收端收到数据后立即发送确认), 总共经历的时延. 
5. 吞吐量(Throughput), 指单位时间内通过某个网络的数据量. 吞吐量受网络带宽或网络额定速率的限制
6. 速率(Speed),  是指连接到计算机网络上的主机在数字信道上 传送数据的速率, 也称数据率或比特率, 单位为 b/s, kb/s, Mb/s,  Gb/s. 最高速度称为带宽 :)

**计算机网络体系结构与参考模型**

各层次中, 每个报文都分为两部分, 一是数据部分, (服务数据单元)SDU, 二是控制信息部分, 协议控制信息(PCI), 它们共同组成协议数据单元(PDU)

n-SDU + n-PCI = n-PDU = (n-1)-SDU

- 计算机网络协议, 接口, 服务

1. 协议: 由语法, 语义和同步三部分组成, 语法规定传输数据格式, 语义规定完成的功能(何种控制信息, 完成何种动作及作出何种应答), 同步规定了执行各种操作的条件, 时序关系. 一个完整的协议应具有线路管理(建立, 释放连接), 差错管理, 数据转换.
2. 接口: 层次间交换信息
3. 服务: 下层能为上层提供的功能调用. 上层使用下层所提供的服务时, 必须与下层交换一些命令, 在OSI中称为服务原句 - 请求, 指示, 响应, 证实 (Request, Indication, Response, Confirmation).

- 计算机网线提供的服务可按三种方式分类 

1. 面向连接服务与无连接服务
2. 可靠服务与不可靠服务
3. 有应答服务与无应答服务

- (开放系统互连参考模型) OSI

1. 应用层 Application Layer

应用层为特定类型的网络应用提供访问OSI环境的手段. 该形使用协议最多, 如FTP, SMTP, HTTP

2. 表示层 Presentation Layer

表示层主要处理在两个通信系统中交换信息的表示方式. (不同机器采用的编码和表示方法不同, 使用的数据结构也不同, 为了使不同表示方法的数据和信息之间能互相交换) 表示层采用抽象的标准方法定义数据结构, 并采用标准的编码形式. 数据压缩, 加密和解密也是表示层可提供的数据表示变换功能.

3. 会话层 Session Layer

会话层允许主机上各个进程之间进行会话, 会话层主要负责管理主机间的会话进程, 包括建立, 管理及终止进程间的会话. (断点恢复通信, 避免重传全部文件)

4. 传输层 Transport Layer

传输单位是报文段(TCP)或用户数据报(UDP), 负责主机中两个进程之间的通信, 功能是为端到端连接提供可靠的传输服务, 为端到端连接提供流量控制, 差错控制, 服务质量, 数据传输管理等服务. 如TCP, UDP.

数据链路层提供的是点到点的通信(一个点是指硬件地址或IP地址), 端到端是指运行在不同主机内的两个进程之间的通信, 一个进程由一个端口来标识.

使用传输层服务, 高层用户可直接进行端到端的数据传输, 从而忽略通信子网的存在. 传输层具有**复用**(是指多个用层进程可同时使用传输层的服务) & **分用**(是指传输层把收到人信息分别交付给上面应用层中相应的进程)的功能.

5. 网络层 Network Layer

传输单位是报, 它关心通信子网的运行控制, 任务: 把网络层的协议数据单元(分组)从源端传到目的端, 为**分组交换网**上的不同主机提供通信服务. 关键问题: 对分组进行路由选择, 并实现流量控制, 拥塞控制, 差错控制和网际互联等功能. 

流量控制与数据链路层的流量控制含义一致, 都为协调A发送频率, B接收频率; 

差错控制是通信两结点之间约定的特殊检错规则, 如奇偶校验码, 能纠错就纠错, 不能就丢弃, 确保向上层提交的数据都是无误的.

拥塞控制是如果网络上的结点都处于来不及接收分组而要丢弃大量分组的情况, 那么网络就处于拥塞状态, 网络层要采取一定的措施来缓解这种拥塞.

因特网是一个很大的互联网, 它由大量异构网络通过路由器(Router)相互连接起来. 其主要网线层协议是无连接的网际协议(Internet Protocol, IP)和许多路由选择协议(如, IP, IPX, ICMP, IGMP, ARP, RARP), 该层又称IP层

6. 数据链路层 Data Link Layer

传输单位是帧, 任务: 是将网络层传来的 IP 数据报组装成帧. 功能: 可概括为 成帧, 差错控制, 流量控制和传输管理. (原始的物理连接在传输比特流时可能发生错误, 由于干扰, 差错控制可发现这些差错; 结点A发送数据比B接收数据快, B会丢弃很多来不及接收的正确数据, 流量控制可协调两结点速率.) 此处, 在广播式网络中, 数据链路层还要处理如何 控制对共享信道的访问. 数据链路层的特殊子层: 介质访问子层. 如SLC, HDLC, PPP, STP和帧中继.

7. 物理层 Physical Layer

传输单位是比特(bit), 任务: 是透明的传输比特流. 功能: 是在物理媒体上为数据端设备透明传输原始比特流. 主要定义: 数据终端设备(DTE)和数据通信设备(DCE)的物理与逻辑连接方法. 如EIA-232C, EIA/TIA RS-449, CCITT的X.21. 传输信息所利用的物理媒体(双绞线, 光缆, 无线信道), 并不在物理层之内.

- TCP/IP 模型

由低到高

1. 网络接口层

功能类似于OSI的物理层与数据链路层, 表示与物理网络的接口, 作用是从主机或结点接收IP分组, 并把它们发送到指定的物理网络上

2. 网际层

TPC/IP 体系结构的关键部分, 与OSI网络层的功能非常相似, 网际层将分组发往任何网络, 并为之独立的选择合适的路由, 但它不保证各个分组有序地到达. 定义了分组的格式和协议, 即IP.

3. 传输层

功能类似于OSI的传输层, 即使得发送端和目的端主机上的对等实体进行会话.  TCP(Transmission Control Protocol) / UDP(User Datagram Protocol)

4. 应用层

如, 虚拟终端Telnet, 文件传输协议FTP, 域名解析服务DNS, 电子邮件协议SMTP, 超文本传输协议HTTP


### 物理层

**通信基础**

- 数据, 信号, 码元(用一个固定时长的信号波形或数字脉冲表示一个k进制数字), 代表不同离散数值的基本波形.

- 信源, 信道, 信宿.

信道: 按传输信号形式不同, 分模拟信道与数字信道. 按传送的信号有基带信号和宽带信号

从通信双方通信方式可分:

1. 单工通信: 只有一个方向的通信, 仅需一条信道, 如无线电广播, 电视广播.
2. 半双工通信: 通信双方都可以发送或接收信息, 需要2条信道, 但不能同时, 如传呼机.
3. 全双工通信: 通信双方可同是发送和接收信息, 需要2条信道, 如电话.

- 速率, 波特, 带宽

速率也称数据率, 指的是数据的传输速率, 表示单位时间内传输的数据量. 可以用码元传输速率和信息传输速率表示(码元传输速率, 指单位时间内传输码元的个数, 单位是波特; 信息传输速率, 指单位时间内传输二进制码元个数, 即比特数, 单位是比特/秒 b/s).

带宽表示通信线路上数据传输能力.

**奈奎斯特定理 与 香农定理**

- 奈奎斯特定理

理想低通信信道下的极限数据传输率 = 2Wlog2V (b/s)

- 香农定理

带宽受限且有高斯白噪声干扰的信道的极限数据传输率 = Wlog2(1 + S/N)

1. W: 带宽, 单位Hz.
2. V: 每个码元离散电平的数目.
3. S: 信道所传输信号的平均功率.
4. N: 为信道内部的高斯噪声功率.
5. S/N: 信噪比 = 10log10(S/N)

**编码与调制**

1. 非归零编码
2. 曼彻斯特编码
3. 差分曼彻斯特编码
4. 4B/5B 编码

采样定理:

在通信领域, 带宽是指最高频率与最低频率之差, 单位为Hz. 假设原始信号中的最大频率为f, 则f采样 必须大于等于最大频率f的2倍.

**电路交换, 报文交换, 分组交换**

**数据报与虚电路**

分组交换根据通信子网向端点系统提供的服务, 还可进一步分为**面向连接的虚电路方式**和**无连接的数据报方式**.

- 数据报

在端系统中实现的高层协议先将报文拆分成若干带有序号的数据单元, 并在网络层加上地址等控制信息后形成网络层PDU. 特点:

1. 发送分组前不需要建立连接, 发送方随时发送分组, 网络中接点可随时接收分组
2. 传输不保证可靠, 可能丢失, 分组到达不一定按顺序
3. 发送的分组中要包含发送端与接收端的完整地址, 以便于独立发送
4. 分组在交换结点存储转发, 需要排队等待, 通信量大时交换结点可能丢弃分组
5. 网络故障时, 变换路径发送, 对故障适应能力强
6. 延时小, 提高了网络吞吐量
7. 收发双方不独占链路, 资源利用率高

- 虚电路

试图将数据报方式与电路交换方式结合, 在分组发送前, 要求在发送方与接收方建立一条逻辑上相连的虚电路, 并一量连接建立, 就固定了虚电路对应的物理路径. 与电路交换类似, 分虚电路建立 + 数据传输 + 虚电路释放.

1. 虚电路通信链路建立和拆除需要时间开销, 对交互式应用和小量的短分组情况显得很浪费, 但对长时间,频繁的数据交换效率很高
2. 虚电路的路由体现在连接建立阶段, 连接建立后, 就确定了传输路径
3. 虚电路提供了可靠的通信功能, 能保证每个分组正确且有序的到达. 此处, 还可对两个数据端点的流量进行控制.
4. 缺点, 网络故障时, 所有经过点故障点的虚电路被破坏
5. 分组首部不是包含目的地址而包含虚电路标识符, 相对数据报开销较小

评价维度: 连接建立与否, 目的地址, 路由选择, 分组顺序, 可靠性, 对网络故障是的适应性, 差错与流量控制

**传输介质**

双绞线, 同轴电缆, 光纤和无线传输介质(无线电波, 微波, 红外线, 激光)

**物理层接口特性**

物理层考虑的是如何在连接到各台计算机的传输媒体上传输数据比特流, 而不指具体的传输媒体. 物理层应屏蔽各种物理设备的差异, 使数据链路层只需要考虑本层的协议和服务. 

1. 机械特性, 如接口形状
2. 电气特性, 如信号电平
3. 功能特性, 如引脚功能
4. 规程特性, 如描述每种功能的事件发生顺序

**物理层设备**

- 中继器

将数字信号整形并放大再转发出去, 区别于放大器(其将衰减的信号放大)

5-4-3规则, 5段通信介质用4个中继器串联只有3段可以挂接计算机

有存储转发功能, 则可以认为它能连接2个不同的协议, 中继器不具体此功能(其2端必须使用同一个协议)

- 集线器 Hub

实质是一个多端口的中继器, 它在网络中只起信号放大和转发的作用, 目的是扩大网络的传输范围, 而不具备信号的定向传送能力(即信号传输的方向是固定的), 是一个标准的共享式设备.

### 数据链路层

**数据链路层功能**

在物理层提供的服务之上向网络层提供服务, 其主要作用是加强物理层传输原始比特流的功能, 将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路, 使之对网络层表现为一条无差错的链路.

- 为网络层提供服务

对网络层而言, 数据链路层的基本任务是将源机器中自网络层的数据传输到目标机器的网络层. 

1. 无确认的无连接服务

源机器发送数据帧时不需要先建立链路连接, 目的机器收到数据帧时不需要发回确认. 丢失的帧交给上层处理, 适用于实时通信或误码率较低的通信信道, 如以太网.

2. 有确认的无连接服

源机器发送数据帧时不需要先建立链路连接, 但目的机器收到时必须发回确认, 源机器在所规定的时间内未收到确定信号时, 就重传丢失的帧, 适用于误码率较高的通信信道, 如无线通信.

3. 有确认的面向连接的服务

帧传输分为三个阶段, 建立数据链路, 传输帧, 释放数据链路. 目的机器对收到的每一帧都要给出确认, 源机器收到确认后和能发送下一帧, 因为该服务的可靠性最高, 适用于通信要求高(可靠性, 实时性)的场合

- 链路管理

数据链路层连接的建立, 维持和释放过程称为链路管理. 在多个站点共享同一物理信道的情况下, (例如在局域网中)如何在要求通信的站点间分配和管理信道也属于数据链路层管理的范畴.

- 帧定界, 帧同步和透明传输

两个工作站之前传输信息时, 必须将网络层的分组封闭成帧, 以帧的格式进行传送. 将一段数据的前后分别添加首部和尾部(含控制信息, 用于确定帧的界限, 即帧定界), 就构成了帧.

帧同步是指, 接收方应能接收到的二进制比特流中区分出帧的起始与终止, 如在HDLC通信规程中, 用标识符F(01111110)来标识帧的开始和结束.

透明传输是指, 不论数据是什么样的比特组合(恰好出现01111110标识比特流), 都应当能在链路上传送.

- 流量控制

流量控制实际上就是限制发送方的数据流量, 使其发送率不超过接收方的接收能力. 

- 差错控制

由于信道噪声, 帧在传输过程中可能会出现错误, 用以使发送方确定接收方是否正确收到其发送数据的方法. 这些错误可分为位错与帧错.

位错指帧中某些位出现了差错. 通常采用循环冗余检验(CRC)方式发现错误, 通过自动重传请求(Automatic Request reQuest, ARQ)方式来重传出错的帧.

帧错指帧丢失, 重复或失序等错误, 在数据链路层引入定时器和编号机制, 能保证每一帧都"正确"交付目的结点.

**组帧**

数据链路层之所以要把比特合成帧为单位传输, 是为了在出错时只重发出错的帧, 而不重发全部数据. 发送方需按一定规则把网络层递交的分组封装成帧(组帧). 组帧主要解决帧定界, 帧同步, 透明传输等问题

- 字符计数法

字符计数是指在帧头部用一个字段来标明帧内字符数(包含其本身所占一个字节数), 问题在于如果计数字段本身出错, GG :)

- 字符填充的首尾定界符法

字符填充法使用一些特定的字段来定界一帧的开始与结束, 同时为了使信息位中出现的特殊字符不被误判, 在特殊字符前加转义字符(DLE), 转义字符DLE, 是ASCII码呻的控制字符.

- 比特填充的首尾标志法

比特填充法允许数据帧包含任意个数的比特, 也允许每个字符的编码包含任务个数的比特. 它使用一个特定的比特模式 01111110 来标志一个帧的开始, 结束. 为了使信息位中出现的比特流不被误判, 发送方在数据链路层的信息位中遇到5个连续的1时, 将自动在其后插入一个0, 而接收方做该过程的逆操作...厉害啦!

- 违规编码法

在物理层进行比特编码时, 通常采用违规编码法, 例如, 曼彻斯特编码方法将 1 编为"高 - 低"电平, 而 0 编为"低 - 高"电平, 而"高 - 高"与"低 - 低"在数据比特中是违规的, 可以借此来定界帧的起终..厉害啦! 局域网IEEE 802即采用此方法.

实际较常采用的是比特填充法和违规编码法.

**差错控制**

检错编码都采用冗余编码技术, 其核心思想是在有效数据发送前, 先按某种关系附加一定的冗余位再发送.

- 奇偶校验码

奇校验码: 1位的校验元 + n -1位信息元, 在一个校验元后, 码长为n的码字中, 1的个数为奇数

只能检测奇数个比特的错误

- 循环冗余校验

又称多式码, 模2除法, 得余数为检验序列(FCS)

带r个校验位的多项式编码可以检测所有长度小于等于r的突发性错误.

- 纠错编码

在每个要发送的数据块附加上足够的冗余信息, 使接收方能够推导出发出的实际是什么比特串, 如海明编码它能发现双比特错, 但只能纠正单比特错.

m个信息位插入r个校验位, 则 2**r >= m + r + 1

海明距离, 合法编码中, 两个码字的最小距离(不同位数). 检错 d + 1 纠错 2d + 1.

**流量控制与可靠传输机制**

- 流量控制, 可靠传输, 滑动窗口机制

流量控制的基本方法是由接收方控制发送方的速率

1. 停止-等待流量控制基本原理

发送方每发送一帧都要等待接收方的应答信号, 才能发送下一帧; 接收方每接收一帧都要反馈一个应答信号, 表示可以接收下一帧, 如果接收方不反馈应答信号, 那么发送方必须一直等待. 每次只允许发送一帧, 然后就陷入等待确认信号中, 传输效率低.

2. 滑动窗口流量控制基本原理

在任意时刻, 发送方都维持一组连续的允许发送的帧的序号, 称为发送窗口; 同时接收方也维持一组连续的允许接收帧的序号, 称为接收窗口. 

滑动窗口有以下重要特性:

a. 只有接收窗口向前滑动, 发送窗口才有可能向前滑动.

b. 从滑动窗口的概念看, 停止-等待协议, 后退N帧协议和选择重传协议只在发送窗口大小与接收窗口大小上有所差别:

> 停止-等待协议: 发送窗口大小 = 1, 接收窗口大小 = 1
> 后退N帧协议: 发送窗口大小 > 1, 接收窗口大小 = 1
> 选择重传协议: 发送窗口大小 > 1, 接收窗口大小 > 1

c. 接收窗口为1时, 可保证接收的帧的有序.
d. 数据链路层的滑动窗口协议中, 窗口的大小在传输过程中是固定的! (注意与传输层的滑动窗口协议的区别)

3. 可靠传输机制

数据链路层的可靠传输通常使用确认和超时重传机制来完成. 

自动重传请求(Auto Repeat reQuest, ARQ)通过接收方请求发送方重传出错的数据帧来恢复出错的数据帧. 传统自动重传请求分为三种: 停止-等待ARQ, 后退N帧ARQ, 选择重传ARQ. (后两种技术与滑动窗口技术结合, 又称连续ARQ), 注意在数据链路层上流量控制与可靠传输机制是交织在一起的.

- 单帧滑动窗口与停止-等待协议

停止-等待协议相当于滑动窗口与接收窗口大小都为1的滑动窗口协议. 在停止-等待协议中, 除数据帧丢失外, 还有以下2种情形

1. 到达目的站的帧已经破坏, 目的站简单丢失帧, 解决方案: 发送方在发出后型计时器.
2. 发送的数据帧正确无误到达目的站, 但确认帧被破坏 -> 发送方重传已经被接收的帧, 解决方案: 接收方发送的确认帧交替用0/1标识"收到的确认有误"/"重传已发送的帧"

- 多帧滑动窗口与后退N帧协议(GBN)

后退N帧式ARQ中, 发送方无需在收到上一个帧的ACK后才能开始发送下一帧, 而是可以连续发送帧. 当接收方检测出失序的信息帧后, 要求发送方重发最一个正确接收的信息帧后所有未被确认的帧; 未者当发送方发送了N个帧后, 若发现该N个帧的前一个帧在计时器超时后, 仍未返回其确认信息, 则该帧被判断为出错或丢失, 此时发送方就不得不重传该出错的帧及随后的N个帧. (换句话说, 接收方只允许按顺序接收.)

后退N帧协议的接收窗口为1, 可以保证按序接收数据帧, 若采用n比特对帧编号, 则其发送窗口的尺寸W应满足`<= 1 W <= 2**n - 1` 若发送窗口的尺寸大于`2**n - 1`, 则会造成接收方无法分辨新帧和旧帧.

- 多帧滑动窗口与选择重传协议(SR)

为了进一步提高信道的利用率, 可设法只重传出现差错的数据帧或计时器超时的数据帧, 但此时必须加大接收窗口, 可便先收下发送序号不连续但仍处在接收窗口中的那些数据帧. 等到所缺序号的数据帧收到后再一并送交主机(此为选择重传ARQ协议)

在选择重传ARQ中, 每个发送缓冲区对应一个计时器, 当计时器超时时, 缓冲区的帧就会重传, 另外, 该协议使用了比上述其它协议更有效的差错处理策略, 即一旦接收方怀疑帧出错, 就会发一个否定帧NAK给发送方, 要求发送对NAK中指定的帧重传.

**介质访问控制**

主要任务, 为使用介质的每个结点隔离来自同一信道上其他结点所传送的信号, 以协调活动结点的传输. (用来决定广播信道中信道分配的协议). 为数据链路层的一个子层, 称为介质访问控制子层(Medium Access Control, MAC)

- 信道划分介质访问控制

信道划分介质访问控制将使用介质的每个设备与来自同一通信信道上的其他设备的通信隔离开来, 把时域和频域资源合理地分配给网络上的设备.

信道划分实质是通过分时, 分频, 分码等方法将原来的一条广播信道逻辑上分为几条用于两个结点之间通信的互不干扰的子信道, 实际上就是把广播信道转变为点对点的信道.

1. 频分多路复用(FDM)

将多路基带信号调制到不同频率载波上, 再叠加形成一个复合信号的多路复用技术. 技术比较成熟, 实现比较容易.

2. 时分多路复用(TDM)

将一条物理信道按时间分为若干时间片, 轮流地分配给多个信号使用. 改进异步时分多路复用(STDM)

3. 波分多路复用(WDM)

波分多路复用即光的频分多路复用, 它在一根光纤中传输多种不同波长(频率)的光信号, 同于波长(频率)不同, 各种光信号互不干扰, 最后再用波分分解复用器将各路波长分解出来. 由于光波处于频谱的高频段, 有很高的带宽, 因而可以实现多路波分复用.

4. 码分多路复用(CDM)

采用不同的编码来区分各路原始信号的复用方式, 共享信道的频率与时间. 码分多址(CDMA), 如A向C发送 110010 代表1, 而B向C发送 001101 代表1. 码分复用技术具有频谱利用率高, 搞干扰能力强, 保密性强, 语音质量好等优点, 还可以减少投资和降低运行成本, 主要用于无线通信系统, 特别是移动通信系统.

- 随机访问介质访问控制

在随机访问协议中, 不采用集中控制方式解决发送信息的次序问题, 所有用户能根据自己的意愿随机地发送信息, 占用信道全部的速率. (但会发生帧的冲突, 碰撞即前面所说干扰). 为解决这个问题, 每个用户需要按照一定的规则反复重传它的帧, 直到该帧无碰撞地通过. 这些规则就是随机访问介质访问控制协议, 常用的有ALOHA, CSMA, CSMA/CD. CMSA/CA, 它们的核心思想都是: 胜利者通过急用获得信道, 从而获得信息的发送权. (争用型协议)

实质是将广播信道转化为点到点信道的行为.

1. ALOHA协议(Additive Link On-line HAwaii system)

纯ALOHA, 随机等待再重传, 吞量低; 时隙ALOHA, 同步各站眯时间, 划分时隙, 时隙开始发送帧, 较纯ALOHA提升一倍.

2. CSMA协议(Carrier Sense Multiple Access, CSMA)

载波侦听多路访问, 发送前侦听信道, 发现信道空闲再发送, 降低冲突可能. 分三种(1-坚持, 非坚持, p-坚持)

3. CSMA/CD协议(Carrier Sense Multiple Access with Control Detection, CSMA/CD)

载波侦听多路访问/碰撞检测协议, 是CSMA协议的改进方案, 适用于总线型网络或半双开网络环境, 工作流程概括为(先听后发, 边听边发, 冲突停发, 随机重发).

2t争用期(冲突窗口或碰撞窗口, 2倍的单向传播时延), 为确保发送站在发送数据的同时能检测到可能的冲突, 需要传输时延至少2倍的传播时延, 可知

`最小帧长 = 总线传播时延*数据传输时延*2`

如以太网规定51.2us为争用期的长度, 对于10Mb/s的以太网, 争用期可发送512bit, 64B, 以太网最小帧长度为64B, 长度不足, 以整数字节填充.

一旦检测到冲突, CSMA/CD采用二进制指数退避算法来解决碰撞问题. 

a. 确定基本退避时间, 一般取争用时间

b. 定义参数k, 它等于重传次数, 但k不超过10

c. 从离散整数集合[0, 1, 2, ..., 2**k - 1]中随机取数r, 重传所需退避的时间为 r倍的基本退避时间

d. 重传16次仍不成功, 说明网络太拥挤, 抛弃此帧并向高层

4. CSMA/CA协议

CSMA/CA协议的基本思想是在发送数据时先广播告知其它结点, 让其它结点在某段时间内不要发送数据, 以免出现碰撞. CSMA/CD协议基本思想是发送前先侦听, 边发送边侦听, 一旦出现碰撞马上停止发送.

- 轮询访问介质访问控制: 令牌传递协议

在轮询访问中, 用户不能随机发发送信息, 而要通过一个集中控制的监控站, 以循环方式轮询每个结点, 再决定信道的分配. 典型的轮询访问介质控制协议是令牌传递协议, 它主要用于令牌局域网中.

适用于负载很高的广播信道(指多个结点同一时刻发送数据的概率很大), 既不共享时间, 也不共享空间, 是在随机访问基础上, 限定了有权力发送数据的结点只有一个. 

即使是广播信道, 也可通过介质访问控制机制使广播信道逻辑上变为点对点的信道, 所以说数据链路层研究的是"点到点"之间的通信.

**局域网**

- 基本概念与体系结构

局域网的特性主要由三个要素决定: 拓扑结构, 传输介质, 介质访问控制方式, 其中最重要的是介质访问控制方式, 它决定着局域网的技术特性.

三种特殊的局域网拓扑实现:

1. 以太网

逻辑拓扑是总线形结构, 物理拓扑是星形或拓展星形结构.

2. 令牌环

逻辑拓扑是环形结构, 物理拓扑是星形结构

3. FDDI(光纤颁数字接口, IEEE 802.5)

逻辑拓扑是环形结构, 物理拓扑是双环结构.

以太网几乎是局域网的代名词. 

- 以太网和IEEE 802.3

IEEE 802.3标准是一种基带总线形的局域网标准, 它描述物理层和数据链路层的MAC子层的实现方法. 通常将802.3局域网简称为以太网.

以太网采用两项措施简化通信: 1. 采用无连接的工作方式. 2. 不对发送的数据帧编号, 也不要求接收方确认, 即以太网尽最大努力交付数据, 提供的是不可靠服务, 对于差错的纠正则由高层完成.

网络适配器(网卡)都有一个全世界唯一的地址(MAC), 6个字节组成, 一般由6组"-"分隔的16进制数表示, 前3组为厂商代码, 后3组由厂商自行分配

- IEEE 802.11

IEEE 802.11是无线局域网的一系列标准, 包括802.11a与802.11b. 它们制定了MAC层协议, 运行在多个物理层标准上. 

- 令牌环网的基本原理

令牌实质是一个特殊格式的MAC控制帧, 它本身不包含信息, 仅控制信道的使用, 确保同一时刻只有一结点能独占信道. 

**广域网**

广域网是因特网的核心部分, 其任务是运送主机所发送的数据. 广域网由一些结点交换机及连接这些交换机的链路组成.

广域网中的重要问题: 路由选择和分组转发. 路由选择协议负责搜索分组从某个结点到目的结点的最佳传输路由, 以便构造路由表, 然后从路由表再构造转发分组的转发表. 分组是通过转发表转发的. PPP和HDLC协议是目前最常用的两种广域网数据链路层控制协议.

- PPP协议

PPP(Point-to-Point Protocol)是使用串行线路通信的面向字节的协议, 该协议应用在直接连接两个结点的链路上. 设计目的主要是用来通过拨号或专线方式建立点对点的连接发送数据, 使其成为各种主机, 网桥和路由器之间简单连接的一种共同解决方案. 所有PPP帧和长度都是整数个字节. 只支持全双工链路, 点对点的链路通信.

- HDLC协议

高级数据链路控制协议(High-level Data Link Control)协议是ISO制定的面向比特的数据链路层协议. 该协议不依赖于任何一种字符编码集. 数据报文可透明传输, 用于实现透明传输的"0比特插入法"易于硬件实现. 全双工通信, 较高的数据传输效率. 所有帧采用CRC检验, 对信息帧顺序编号, 可防止漏收或重发, 传输可靠性高. 传输控制与处理功能分离, 具有较大灵活性.

- 数据链路层网络设备

1. 网桥概念及其基本原理

两个或多个以太网通过网桥连接后, 就成为一个覆盖范围更大的以太网, 而原来的每个以太网就称为一个网段. 网桥工作在MAC子层, 可以使以太网各网段成为隔离开的碰撞域. 网桥处理对象是帧, 是数据链路层设备, 而中继器, 放大器处理数据的对象是信号, 所以它是工作在物理层的设备.

2. 局域网交换机及其工作原理

桥接器的主要限制是在任一时刻通常只能执行一个帧的转发操作, 于是出现了局域网交换机, 又称以太网交换机, 其实质是一个多端口的网桥, 它工作在数据链路层. 

### 网络层

**网络层的功能**

- 异构网络互联

不同的寻址方案, 不同的网络接入机制, 不同的差错处理方法, 不同的路由选择机制. 网络互联, 是指将两个以上的计算机网络, 通过一定的方法, 用一种或多种通信处理设备(中间设备)连接起来, 以构成更大的网络系统. 中间设备又称为中间系统或中继系统. 中继系统有:

1. 物理层中继: 中继器, 集线器(hub)

2. 数据链路层中继: 网桥或交换机

3. 网络层中继: 路由器

4. 网络层以上中继: 网关

使用物理层或数据链路层的中继系统时, 只是把一个网络扩大了, 从网络层的角度看, 仍是同一个网络, 一般不称为网络互联. 因此网络互联通常是指用路由器进行网络互联和路由选择. (路由是一台专用计算机, 用于在互联网中进行路由选择)

TCP/IP体系在网络互联上采用的方法是在网络层(即IP层)采用标准化协议, 但相互连接的网络可以是异构.

- 路由与转发

路由器主要完成两个功能: 一是路由选择(构造, 更新, 维护路由表), 二是分组转发(处理通过的数据流). 

- 拥塞控制

在通信子网中, 因出现过量的分组而引起网络性能下降的现象称为拥塞. 拥塞控制主要解决的问题是如何获取网络中发生拥塞的信息, 从而利用这些信息进行控制, 以避免由于拥塞而出现的分组的丢失, 以及严重拥塞而产生网络死锁的现象.

流量控制是指接收方能有效接收发送的数据, 为点对点的控制; 拥塞控制是指通信子网有能力传送待传送的数据, 是全局的控制.

拥塞控制的2种方法: 开环控制, 事前设计; 闭环控制, 监测网络状态, 基于反馈的控制.

**路由算法**

- 静态路由与动态路由

以能否随网络的通信量或拓扑自适应地进行调整变化划分为

a. 静态路由算法

b. 动态路由算法, 距离-向量路由算法 与 链路状态路由算法

- 距离-向量路由算法

此算法中, 所有结点都定期将它们的整个路由 选择表传送给所有与之直接相邻的结点. 这种路由表包含: 每条路径的目的地(另一结点); 路径的代价(也称距离, RIP将距离定义为跳数, 指从源商品到目的端口所经过的路由个数).

所有结点都必须参与距离向量交换, 以保证路由的有效性与一致性, 并在下列情况下更新它们的路由选择表:

1. 被通告一条新的路由
2. 发来的跌幅信息中一条到达某个目的地的跌幅, 与当前使用的跌幅相比, 有较小的距离

距离-向量路由算法的实质是, 迭代计算一条路由中的站段数或延迟时间, 从而得到到达一个目标的最短通路. 它要求每个结点在每次更新时都将它的全部跌幅表发送给所有相邻的结点. 通信子网上传送的路由选择信息的数量很容易变得非常大.

- 链路状态路由算法

链路状态算法要求每个参与该算法的结点都具有完全相同的网络拓扑信息, 它们执行2项任务. 一, 主动测试所有相邻结点的状态. 两个共享一条链接的结点是相邻结点, 它们连接到同一条链路, 或者连接到同一个广播型物理网络. 二, 定期地将链路状态传播给所有其他结点(或称路由结点). 典型的链路状态算法是OSPF算法.

三个特征:

1. 向本算法系统中, 路由器通过所有端口向所有相邻的路由器发送信息.
2. 发送的信息是与路由器相邻的所有路由器的链路状态, 但这只是路由所知道的部分信息. 对于OSPF算法, 链路状态的度量有费用, 距离, 时延, 带宽
3. 只有链路状态变量时, 路由器才发送

链路状态报文与网络中路由结点数无关, 比向量-距离路由算法有更好的规模可伸性

- 层次路由

网络规模扩大时, 路由表成比例增大, 因特网将整个互联网划分为许多小的自治系统. 据此, 因特网把路由选择协议分为2大类:

1. 自治系统内部使用的路由选择协议 - 内部网关协议(IGP), 也称域内路由选择, 具体有RIP, OSPF
2. 自治系统之间使用的路由选择协议 - 自问网关协议(EGP), 也称域间路由选择, 具体有BGP

**IPv4**

- IPv4分组

IPv4, 是指现在普遍使用的IP(版本4), IP定义数据传送的基本单元, IP分组及其确切的数据格式, IP也包括一套规则, 指明分组如何处理, 错误怎样控制. 特别是IP还包含非可靠投递的思想, 以及与此关联的分组路由选择的思想.

1. IPv4分组的格式

一个IP分组由首部和数据两部分组成. 首部前一部分的长度固定, 共20B, 是所有IP分组必须具有的. 在首部固定部分的后面是一些可选字段, 其长度可变, 用来提供错误检测及安全等机制.

首部固定长度重要字段含义有:

版本, 首部长度, 总长度, 标识, 标志, 片偏移, 首部校验和, 生存时间, 协议, 源地址字段, 目的地址字段.

2. IP数据报分片

一个数据链路层数据报能承载的最大数据量, 称为最大传输单元, MTU, 当IP数据报的总长度大于链路层MTU时, IP数据报中的数据分装在多个较小的IP数据报中, 称为片. 每个片都有原始数据报的标识号+片偏移重组装原始数据报.

3. 网络层转发分组的流程

...

- IPv4地址与NAT

1. IPv4地址

连接到因特网上的每台主机(或路由器)都分配一个32比特的全球唯一标识符, 即IP地址. 传统的IP地址是分类的地址, 分为A, B, C, D, E五类. 由网络号 + 主机号2部分组成. 其中, 网络号标志主机(或路由器)所连接到的网络. 一个网络号在整个因特网范围内必须是唯一的. 主机号标志该主机(或路由器). 主机号在其网络号所指明的网络范围内必须是唯一的. 

a. A类(1~126), 1字节表示网络号, 3字节表示主机号, 可用网络 2**7 - 2(0.x.x.x, 127.x.x.x) [ 0xxx xxxx, xxxxxxxx, xxxxxxxx, xxxxxxxx ]

b. B类(128~191), 2字节表示网络号, 2字节表示主机号, 可用网络 2**14 - 1(128.x.x.x) [ 10xx xxxx, xxxxxxxx, xxxxxxxx, xxxxxxxx ]

c. C类(192~223), 3字节表示网络号, 1字节表示主机号, 可用网络 2**21 - 1(192.0.0.x) [ 110x xxxx, xxxxxxxx, xxxxxxxx, xxxxxxxx ]

d. D类(224~239), 多播地址 [ 1110 xxxx, xxxxxxxx, xxxxxxxx, xxxxxxxx ]

e. E类(240~255), 保留今后使用 [ 1111 xxxx, xxxxxxxx, xxxxxxxx, xxxxxxxx ]

此外:

主机号全为0表示本网络本身, 主机号全为1表示本网络的广播地址, 127.0.0.0保留为环路自检地址. 32位为0, 0.0.0.0表示本网络上的本主机. 32位为1, 255.255.255.255表示整个TCP/IP网络的广播地址, 又称受限广播地址, 实例使用时, 路由将之等效为本网络的广播地址.

IP地址的特点:

1) 每个IP地址都由网络号与主机号组成, 好处: 一, IP地址管理机构在分配IP地址时只分配网络号, 主机号自行分配. 二, 路由时, 根据目的主机的网络号转发分组, 减小路由表所点的存储空间.

2) IP地址是标志一台主机和一条链路的接口. 当一台主机连接2个网络时, 该主机同时拥有2个IP地址, 且其网络号与对应的网络的网络号相同. IP网络上的路由器至少应具有2个IP地址(路由器每个端口必须至少分配一个IP地址)

3) 转发器或网桥连接若干个LAN时, 仍然是同一个网络, 网络号相同, 但主机号不同

4) IP地址中所有分配到的网络号的网络是平等的

5) 同一个局域网上的主机或路由的IP地十中的网络是一样的, 路由器总是具有2个或以上的IP地址(路由其本身的功能就是连接不同网络:smile:), 每个端口一个不同网络号的IP地址.

2. 网络地址转换(NAT)

网络地址转换是指通过将专用网络地址转换为公用地址, 从而对外隐藏内部管理的IP地址. 作用: IP(公网)地址重用, 隐藏内部网络结构, 降低内网被攻击风险.

私有IP地址只用于LAN

A类: 1个网段: 10.x.x.x

B类: 16个网段: 172.16.x.x ~ 172.31.x.x

C类: 256个网段: 192.168.0.x ~ 192.168.255.x

NAT路由器, 在转发IP分组时, 根据NAT表, 转换源IP地址或目的IP地址.

- 子网划分与子网掩码, CIDR

1. 子网划分

划分子网, 是对主机号再划分. 子网的主机号全0表示子网本身, 全1表示子网的广播地址.

2. 子网掩码

使用子网掩码来表示对原网络中主机号的借位, 它由一串1 + 一串0组成(共32位), 如11111111.00000000.00000000.00000000

路由器在相互交换路由信息时, 必须把自己所在网络(或子网的)的子网掩码告诉对方. 在使用子网掩码的时:

a. 一台主机在设置IP地址信息时, 必须设置子网掩码

b. 同属于一个子网的所有主机及路由器的相应端口, 必须设置相同的子网掩码

c. 路由器的路由表中, 所包含的信息主要内容必须有目的网络地址, 子网掩码, 下一跳地址

3. 无分类域间跌幅选择(CIDR)

CIDR斜线表示法, CIDR地址块构成超网(实质是路由聚合)

- ARP, DHCP与ICMP

1. IP地址与硬件地址

通过数据封闭, 把IP数据报分组封装为MAC帧后, 数据链路层看不见数据报分组中的IP地址.

2. 地址解析协议(ARP)

无论网络层使用什么协议, 在实际网络的链路上传送数据帧时, 最终必须使用硬件地址. 所以需要一种方法来完成IP地址到MAC地址的映射. 这就是地址解析协议(Address Resolution Protocol, ARP). 

每台主机都设有一个ARP调整缓存, 用来存放本局域网上各主机和路由器的IP地址到MAC地址的映射表, 称ARP表, 使用ARP来动态维护此ARP表. ARP 工作在网络层. 查表+广播询问

3. 动态主机配置协议(DHCP)

动态主机配置协议(Dynamic Host Configuration Protocol, DHCP)用于给主机动态地分配IP地址, 它提供了即插即用的联网机制. DHCP是应用层协议, 基于UDP.

4. 网际控制报文协议(ICMP)

为提高IP数据报交付成功的机会, 使用网际控制报文协议(Internet Control Message Protocol, ICMP), 来让主机或路由器报告差错和异常情况, ICMP报文作为IP层数据报的数据, 加上数据报的首部, 组成IP数据报发送, ICMP是IP层协议(网络层)

**IPv6**

- IPv6的主要特点

解决IP地址耗尽的措施: 

1. 采用无类别编址CIDR, 使IP地址的分配更加合理
2. 采用网络地址转换NAT以节省全球IP
3. 采用具体更大地址空间的新版本的IPv6

IPv6的主要特点

1. 从32位增大到128位, 4字节到16字节
2. 拓展的地址层次结构
3. 灵活的首部格式
4. 改进的选项
5. 允许协议继续扩充
6. 支持即插即用
7. 支持资源预分配
8. IPv6只有在包的源结点才允许分片
9. IPv6首部是8字节的倍数
10. 增大安全性, 身份验证与保密功能是IPv6的关键特征

- IPv6地址

IPv6数据报的目的地址可以是以下三种基本类型地址之一:

1. 单播
2. 多播
3. 任播, 新增, 目的站是一组计算机, 但数据报在交付时, 只交付其中的一台计算机, 通常是距离最近的计算机.

表示示例: 4BF5:AA12:0216:FEBC:BA5F:039A:BE9A:2170 每4位用一个16进制数表示.

过渡期使用双协议栈与隧道技术2种策略.

**路由协议**

- 自治系统

自治系统(Autonomous System, AS): 单一技术管理下的一组路由器, 自治系统内的所有路由器都必须是连通的.

- 域内跌幅与域间路由

自治系统内路由称为域内路由, 自治系统间的路由称为域间路由. 因特网有2大类路由选择协议

1. 内部网关协议(Interior Gateway Protocol, IGP)

目前这类路由选择协议使用的最多, 如RIP, OSPF

2. 外部网关协议(External Gateway Protocol, EGP)

当数据报传送到一个自治系统的边界时(2个自治系统可能使用不同的IGP), 需要一种协议将路由选择信息传递到另一个自治系统中, 如BGP-4

- 路由信息协议(RIP)

路由信息协议(Routing Infomation Protocol, RIP)是内部网关协议(IGP)中最先得到广泛应用的协议, RIP是一种分布式的基于距离向量的路由选择协议, 其最大的优点是简单.

1. RIP规定

a. 网络中每个路由器维护从它自身到其它每个目的网络的距离记录(国此这是一组距离, 称为距离向量).

b. 距离也称跳数(Hop Count)规定从一个路由到直接连接网络的距离为1, 而每经过一个路由器, 距离(跳数)加1.

c. RIP认为好的路由就是它通过的路由器的数目少, 即优先选择跳数少的路径

d. RIP允许一条路径最多只能包含15个路由器(最多允许15跳), 因此距离等于16时, 它表示网络不可达. 可见RIP只选用于小型互联网. 距离向量路由可能会出现环路的情况, 规定路径上的最高跳数的目的是为防止数据不断循环在环路上, 减小网络拥塞的可能性.

e. RIP默认在任意两个使用RIP的路由器之间每30秒广播一次RIP路由更新信息, 以便自动建立并维护路由表(动态维护)

f. 在RIP中不支持子网掩码的RIP广播, 所以RIP中每个网络的子网掩码必须相同, 但在新的RIP2中, 支持变长子网掩码和CIDR. 

2. RIP的特点(注意与OSPF的特点比较)

a. 仅和相邻路由器交换信息

b. 路由器交换的信息是当前路由器所知道的全部信息, 即自己的路由表.

c. 按照固定的时间间隔交换路由信息, 如每隔30秒.

RIP通过距离向量算法来完成路由表的更新, 经过若干"跳", 所有路由器都知道了整个IP网络的路由表, 每个路由器到每个目标网络的路由都是距离最短的, 最怕还存在另一条高速(低时延), 但路由器数量较多的路由.

3. 距离向量算法

每个路由表项目都有三个关键数据: `<目的网络的N, 距离d, 下一跳路由X>`

RIP最大的优点是简单, 开销小, 收敛过程较快. RIP 的缺点:

a. RIP限制了网络的规模, 它能使用的最大距离为15.

b. 路由器之间交换的是路由器中的完整路由表, 因此网络规模越大, 开销也越大.

c. 网络出现故障时, 会出现慢收敛现象(即需要较长时间才能将此信息传送到所有路由器, "坏消息传的慢")

RIP是应用层协议, 它使用UDP传送数据(端口520). RIP选择的路径不一定是时间最短的, 但一定是具有最少路由器的路径.

- 开放最短路径优先协议(OSPF)

1. OSPF协议的基本特点

开放最短路径优先协议(OSPF)是使用分布式链路状态路由算法的典型代表, 也是内部网关协议的一种. OSPF与RIP相比有以下4个主要区别:

a. OSPF向本自治系统的所有路由器发送信息, 这里使用的是洪泛法. 而RIP仅向自己相邻的路由器发送信息.

b. 发送的信息是与本路由器相邻的所有路由器的链路状态, 但这只是路由器所知道的部分信息. "链路状态"说明本路由器和哪些路由器相邻及该链路的"度量"(或代价). 而在RIP中, 发送的信息是本路由器所知道的全部信息, 即整个路由表.

c. 只有当链路状态发生变化时, 路由器才用洪泛法向所有路由发送此信息, 并且更新过程收敛得快, 不会出现RIP的坏消息传的慢问题. 而RIP不管网络拓扑是否发生变化, 路由器之间都定期交换路由表信息.

d. OSPF是网络层协议, 它不使用UDP或TCP, 而直接用IP数据报传送(其IP数据报首部的协议字段为89), 而RIP是应用层协议, 它在传输层使用UDP.

2. OSPF的基本工作原理

由于各路由之间频繁的交换链路状态信息, 因此所有路由最终都能建立起一个链路状态数据库. 这个数据库实际上就是全网的拓扑结构图, 使用Dijkstra最短路径算法从自己到各目的网络的最优路径, 以此构造自己路由表. 此后, 链路状态发生变化时, 每个路由器重新计算到各目的网络的最优路径, 构造新的路由表.

为使OSPF能够用于规模很大的网络, OSPF将一个自治系统再划分为若干更小的范围, 称为区域, 划分区域的好处在是, 利用洪泛法交换链路状态信息的范围局限于每个区域而非整个自治系统, 减少了整个网络上的通信量.

3. OSPF的五种分组类型

a. 问候分组

b. 数据库描述分组

c. 链路状态请求分组

d. 链路状态更新分组

e. 链路状态确认分组

- 边界网关协议(BGP)

边界网关协议(Border Gateway Protocol, BGP)是不同自治系统的路由器之间交换信息的协议, 是一种外部网关协议. 常用于互联网的网关之间. 路由表包含已知路由器的列表, 路由器能够达到的地址及到达每个路由器的路径的跳数.

BGP是应用层协议, 基于TCP. 

**IP组播**

- 组播的概念

为了能够支持像视频点播和视频会议这样的多媒体应用, 网络必须实施某种有效的组播机制. 组播机制是让源计算机一次发送的单个分组可以抵达用一个组地址标识的若干目标主机, 并被它们正确接收.

组播一定仅应用于UDP.

因特网中IP组播也使用组播组的概念, 每个组都有一个特别分配的地址, 要给该组发送的计算机将使用这个地址作为分组的目标地址. 在IPv4中, 这些地址在D类地址空间中分配, IPv6中也有一部分地址空间保留给组播组.

主机使用一个称为IGMP(因特网组管理协议)的协议加入组播组. ... 组播需要路由器的支持才能实现. 

- IP组播地址

- IGMP与组播路由算法

**移动IP**

支持移动性的因特网体系结构与协议共称为移动IP, 它是为了满足移动结点(计算机, 服务器, 网段)在移动中保持其连接性而设计的. 更确切的移动IP技术是指移动结点为以固定网络IP地址实现跨越不同网段的漫游功能, 并保证基于网络IP的网络权限在漫游过程中不发生任何改变. 

基于IPv4的移动IP定义三种功能实体: 移动结点, 归属代理(也称本地代理), 和外埠代理(也称外部代理)

1. 移动结点, 具有永久IP地址的移动结点.
2. 本地代理, 在一个网络环境中, 一个移动结点的永久"居所"被称为归属网络, 在归属网络中代表移动结点执行移动管理功能的实体称为归属代理, 它根据移动用户的转交地址, 采用隧道技术转交移动结点的数据包.
3. 外部代理, 在外部网络中帮助移动结点完成移动管理功能的实体称为外部代理

**网络层设备**

- 路由器的组成和功能

路由器一种具有多个输入/输出端口的专用计算机, 其任务是连接不同的网络(连接异构网络)并完成路由转发. 在多个逻辑网络(即多个广播域)互联时必须使用路由器. 路由器也可以作为最基础的包过滤防火墙应用.

同网络间数据包不需要通过路由器, 跨网络必须使用路由器. 路由器隔离了广播域.

从结构上看路由器由路由选择和分组转发2部分构成; 而从模型的角度看, 路由器是网络层设备, 它实现了网络模型的下三层(物理层, 数据链路层, 网络层)

- 路由表与路由转发

路由表是根据路由算法得出, 主要用途是路由选择. 标准的路由表有4个项目: 目的网络IP地址, 子网掩码, 下一跳IP地址, 接口.

### 传输层

**传输层提供的服务**

- 传输层的功能

从通信和信息处理的角度看, 传输层向它上面的应用层提供通信服务, 它属于面向通信部分的最高层, 同时也是用户功能中的最低层.

传输层位于网络层之上, 它为运行在不同主机上的进程之间提供了逻辑通信, 而网络层提供主机之间的逻辑通信. 显然, 即使网络层协议不可靠(网络层协议使分组丢失, 混乱, 重复), 传输层同样能为应用程序提供可靠的服务. 传输层提供的功能如下:

1. 传输层提供应用进程之间的逻辑通信(即端到端的通信), 与网络层的区别是, 网络提供的是主机之间的逻辑通信.
2. 复用和分用. 复用是指发送方不同的应用进程都可使用同一个传输层协议传送数据. 分用是指接收方的传输层在剥去报文首部后能够把这些数据正确交付到目的应用进程.
3. 传输层还要对收到的报文进行差错检测(首部和数据部分), 而网络层只检查IP数据报的首部, 不检验数据部分是否出错.
4. 提供两种不同的传输协议, 即面向连接的TCP和无连接的UDP.而网络层无法同时实现两种协议(即在网络层要么只提供面向连接的服务, 如虚电路; 要么只提供无连接服务, 如数据报, 而不可能在网络层同时存在这两种方式).

- 传输层的寻址与端口

1. 端口能够让应用层的各种应用进程将其数据通过端口向下交付给传输层, 以及让传输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程. 端口是传输层服务访问点(TSAP), 它在传输层的作用类似于IP地址在网络层的作用或MAC在数据链路层的作用. 传输层所说的端口是软件端口.
2. 端口号. 应用程序通过端口号进行标识, 端口号长度为16bit(2字节/2B), 能够表示65536(2**16)个不同的端口. 端口号只具有本地意义. 根据端口号范围, 可分为2类

a. 服务疝使用的端口号. 又分2类, 最重要的一类是熟知商品号, 数值在0~1023, IANA(互联网地址指派机构)把这些端口号指派给了TCP/IP最重要的一些应用程序, 让所有的用户都知道. 另一类是登记端口号, 数值1024~49151. 它是供没有熟知端口号的应用使用的.

一些常用的熟知端口号: FTP: 21, HTTP: 80, TELNET: 23, SMTP: 25, DNS: 53

b. 客户端使用的端口口, 数值为49152~65535. 这类端口号仅在客户进程运行时才动态选择, 因此又称短暂端口号(也称临时端口号), 通信结束, 端口号就不复存在, 又可再供其它客户端应用程序使用.

3. 套接字

在网络中通过IP地址来标识和区别不同的主机, 通过端口号来标识和区分一台主机中的不同应用进程. 在网络中采用发送方和接收方的套按字(Socket)组合来标识端点. 所谓套接字, 实际上一个通信端点, 即:

套接字 = (主机IP地址, 端口号)

它唯一的标识了一台主机和其上的一个应用(进程)

- 无连接的服务与面向连接的服务

面向连接的服务就是在通信双方进行通信之前, 必须先建立连接, 在通信过程中, 整个连接的情况一直被实时的监控和管理. 通信结束后, 释放这个连接.

无连接服务是指两个实体之间的通信不需要先建立好连接, 需要通信时, 直接将信息发送到网络中, 让该信息的传递在网上尽力而为地往目的地传送.

TPC提供面向连接的可靠传输服务, 不提供组播广播服务. 资源消耗大, 适用于可靠性更重要的场合, 如文件传输协议(FTP), HTTP, (远程登录)TELNET等.

UDP是一个无连接的非可靠传输层协议, 它在IP之上仅提供两个附加服务: 多路复用和对数据的错误检查. UDP较简单, 执行速度较快, 实时性较好. 使用有: RTP(实时传输协议).

**UDP**

- UDP数据报

1. UDP概述

RFC768定义的UDP仅在IP之上增加了2个基本的服务: 复用分用; 差错检测. 但UDP有如下优点:

a. UDP无需建立连接, 因此没有建立连接的时延

b. 无连接状态, 意味着资源消耗低

c. 分组首部开销小, TCP有20B的首部开销, UDP仅8B开销.

d. 应用层能更好的控制要发送的数据和发送的时间, UDP没有拥塞控制, 因此网络中的拥塞不会影响主机的发送效率. 某些实时应用要求以稳定的速度发送, 能容忍数据的丢失, 但不允许有较大的时延, UDP正满足需求.

UDP是面向报文的, 仅添加或去除首部就交付给IP层或应用层, 因此报文不可分割, 是UDP数据报处理的最小单位.

2. UDP的首部格式

UDP数据报包含2部分: UDP首部与用户数据, 整个UDP数据报作为IP数据报的数据部分封装在IP数据报中. UDP首部有8B, 由4个字段组成, 每个字段2B.

a. 源端口, 在需要对方回信时选用, 不需要时全为0

b. 目的端口, 在终点交付报文时必须使用到.

c. 长度, UDP数据报的长度(包括首部和数据), 其最小值是8(仅有首部)

d. 校验和, 检测UDP数据报在传输中是否有错, 有错就丢弃, 当源主机不想计算检验和时, 可全为0.

- UDP检验

计算检验和之前, 在UDP数据报之前增加12B的伪首部, 伪首部仅计算检验和用. 伪首部包括(4字节源IP地址, 4字节目的IP地址, 1字节0, 一字节17, 2字节UDP长度), 计算方式与IP首部检验和类似, 都使用二进制白马非马去处求和再取反, 不同的是IP首部检验和仅检验IP首部, 而UDP首部检验和检验首部和数据2部分.

**TCP协议**

- TCP协议的特点

TCP是在不可靠的IP层之上实现的可靠的灵气传输协议, 它主要解决传输的可靠, 有序, 无丢失和不重复问题. TCP是TCP/IP体系中非常复杂的一个协议, 主要的特点有:

1. TCP是面向连接的传输层协议
2. 每条TCP连接只能有2个端点, 每条TCP连接只能是点对点的(1对1).
3. TCP提供可靠的交付服务, 保证传送的数据无差错, 不丢失, 不重复且有序.
4. TCP提供全双式通信, 允许通信双方的应用进程在任何时候都能发送数据, 为此TCP连接的2端都设有发送缓存和接收缓存, 用来临时存放双向通信的数据.
5. TCP是面向字节流的, 虽然应用程序TCP的交互是一次一个数据块, 但TCP把应用程序交下来的数据仅视为一连串的无结构的字节流.

- TCP报文段

TCP传送的数据单元称为报文段. 一个TCP报文段分为TCP首部和TCP数据两部分, 整个TCP段作为IP数据报的数据部分封装在IP数据报中. TCP报文段首部前20B是固定的, TCP报文段首部最短为20B, 后面有4N字节是根据需要而增加的选项, 通常长度是4B的整数倍.

TCP的报文段即可以用来运载数据, 又可以用来建立连接, 释放连接和应答. 各段意义如下:

1. 源端口和目的端口字段, 各占2B. 传输层的复用和分用功能都通过端口实现.
2. 序号字段, 占4B, TCP是面向字节流的, 所以TCP连接传送的数据流中的每个字节都编上一个序号, 序号字段的值是指本报文段所发送的数据的第一个字节的序号.
3. 确认号字段, 占4B, 是期望收到对方的下一个报文段的数据的第一个字节的序号. 若确认号为N, 则表明N-1为止的数据都正确收到.
4. 数据偏移(即首部长度), 占4bit, 它指明TCP报文段的数据起始处距离TCP报文段的起始处有多远. 数据偏移的单位是32bit(4B, 与IP协议首部中首部长度的单位一致), 可知, TCP首部的最大长度是60.
5. 保留字段, 占6bit, 保留今后使用, 目前应置为0
6. 紧急位URG, URG=1时, 表明紧急指针字段有效. 它告诉系统报文段中有紧急数据, 应尽快传送(相当于高优先级的数据), URG需要和紧急指针配套使用, 即数据从每一个字节到紧急指针所指字节就是紧急数据.
7. 确认位ACK, 只有当ACK=1时, 确认号字段才有效, 当ACK=0时, 确认号无效.
8. 推送位PSH, 接收TCP收到PSH=1的报文段, 就尽快地交付给接收应用进程, 而不再等整个缓存都填满后再向上交付.
9. 复位位RST, RST=1时, 表明TCP连接中出现严重差错,(如主机崩溃或其他原因), 必须释放连接, 然后再重新建立运输连接.
10. 同步位SYN, 同步SYN=1表示这是一个连接请求或连接接收报文., 当SYN=1, ACK=0时, 表明这是一个连接请求报文, 对方若同意建立连接, 则在响应报文中使用SYN=1, ACK=1.
11. 终止位FIN, 用来释放一个连接, FIN=1表明此报文段我的发送方的数据已发送完毕, 并要求释放传输连接.
12. 窗口字段, 占2B, 它指出现在允许对方发送的数据量(接收方的数据缓存空间).
13. 校验和, 占2B. 与UDP的检验和类似, 伪首部: 源IP, 目的IP, 0, 6, TCP长度.
14. 紧急指针字段, 占16bit, 指出在本报文段中紧急数据共有多少字节
15. 选项字段, 长度可变.
16. 填充字段, 使首部保持为4B的整数倍

- TCP连接管理

TCP是面向连接的协议, 每个TCP连接都有三个阶段: 连接建立, 数据传输, 连接释放.

在连接建立过程中, TCP要解决以下三个问题: 

a. 要使每一方都能确知对方的存在.

b. 要允许双方协商一些参数(如最大窗口值, 是否使用窗口扩大选项, 时间戳选项及服务质量等)

c. 能够对运输实体资源(如缓存大小, 连接表中的项目)进行分配

每条TCP连接唯一地被通信两端的两个端点(即两个套接字)确定.

TCP连接的建立采用客户/服务器方式, 主动发起连接建立的应用进程称为客户机(Client), 而被动等待建立的应用进程称为服务器(Server).

1. TCP连接的建立

三次握手.

第一步: 客户机的TCP首先向服务器的TCP发送一个连接请求报文段. 这个特殊的报文段中不包含应用层数据, 其首部中的SYN=1, 另外, 客户机会随机选择一个起始序号seq=x(连接请求报文不携带数据, 但要消耗一个序号)

第二步: 服务器的TCP收到连接请求报文段后, 如同意建立连接, 就向客户机发回确认, 并为该TCP连接分配TCP缓存和变量. 在确认报文段中, SYN和ACK位都被置为1, 确认号字段的值为x+1, 并且服务器随机产生起始序号seq=y(确认报文不携带数据, 但也要消耗一个序号).

第三步: 当客户机收到确认报文段后, 还要向服务器发出确认, 并且也要给该连接分配缓存和变量. 这个报文段的ACK=1, seq=x+1, 确认号ack=y+1. 该报文段可以携带数据, 若不携带数据, 则不消耗序号.

值得注意的是, 服务器端的资源是在完成第二次握手时分配的, 而客户端的资源是在完成第三次握手时分配的, 这就使得服务器易于受到SYN洪泛攻击.

2. TCP连接的释放

参与TCP连接的2个进程中的任何一个都可终止连接, 该过程称为四次挥手.

第一步: 客户机打算关闭连接时, 向其TCP发送一个连接释放报文段, 并停止发送数据, 主动关闭TCP连接, 该报文的FIN标志位被置为1, seq=u, 它等于前面已传送过的数据的最后一个字节的序号加1(FIN报文段即使不携带数据, 也要消耗一个序号). TCP是全双工通信, 可以"想象"为一条TCP连接上有2条数据通路. 发送FIN报文时, 发送FIN的一端不能再发送数据, 即关闭了其中一条数据通路, 但对方还可以发送数据.

第二步: 服务器收到连接释放报文段后即发出确认, 确认号是ack=u+1, 而这个报文段自己的序号是v, 等于它前面已传送过的数据的最后一个字节的序号加1. 此时, 从客户机到服务器这个方向的连接就释放了, TCP连接处于半关闭状态. 但服务器若发送数据, 客户机仍要接收, 即从服务器到客户机这个方向的连接并未关闭.

第三步: 若服务器已经没有要向客户机发送的数据, 就通知TCP释放连接, 此时其发出的FIN=1, seq=w, ack=u+1.

第四步: 客户机收到连接释放报文段后, 必须发出确认. 在确认报文段中, ACK字段被置为1, 确认号为ack=w+1. 此时连接还未释放, 必须经过时间等待计时器设置的时间2MSL后, A才进入连接关闭状态.

- TCP可靠传输

TCP的任务是在IP层不可靠的, 尽力而为服务的基础上建立一种可靠的数据传输服务. TCP提供的可靠数据传输服务保证接收方进程从缓存区读出的字节流与从发送方发出的字节流完全一样. TCP使用了检验, 序号, 确认和重传等机制来达到这一目的. TCP的校验机制与UDP一样(取反求和再取反)

1. 序号

TCP首部的序号字段用来保证数据能有序提交给应用层, TCP把数据视为一个无结构但有序的字节流, 序号建立在传送的字节流之上, 而不建立在报文段之上. (有序是指发出的字节流编号之有序, 而非发出的报文段有序)

2. 确认

TCP首部的确认号期望收到对方的下一个报文段的数据的第一个字节的序号. 发送方缓存区会继续存储那些已发送但未收到确认的报文段, 以便在需要时重传. 

TCP默认使用累计确认, 即TCP只确认数据流中至第一个丢失字节为止的字节. 

3. 重传

两种事件会导致TCP对报文段进行重传: 超时和冗余ACK.

a. 超时

TCP每发送一个报文段, 就对这个报文段设置一次计时器. 计时器设置的重传时间到期还未收到确认时, 就要重传这一报文段.

由于TCP的下层是一个互联网环境, IP数据报选择的路由变化很大, 因而传输层的往返时延的方差也很大. 为了计算超时计时器的重传时间, TCP采用一种自适应的算法, 它记录一个报文段发出的时间, 以及收到相应确认的时间, 这两个时间之差称为报文段的往返时间(Round-Trip Time, RTT). TCP保留了RTT的一个加权平均往返时间RTT(s)

b. 冗余ACK(冗余确认)

超时触发重传存在的一个问题是超时周期往往太长, 发送方还可以在超时事件发生之前, 通过冗余ACK来较好的检测丢包情况. 冗余ACK就是再次确认某个报文段的ACK, 而发送方先前已经收到过该报文段的确认. TCP规定当发送方收到对同一个报文段的3个冗余ACK时, 就可以认为跟在这个被确认报文段之后的报文段已经丢失. 也称为快速重传.

- TCP流量控制

TCP提供流量控制服务来消除发送方使接收方缓存区溢出的可能性, 因此可以说流量控制是一个速度匹配服务(匹配发送方的发送速率与接收方的接收速率.)

TCP提供一种基于滑动窗口协议的流量控制机制:

在通信过程中, 接收方根据自己接收缓存的大小, 动态地调整发送方的发送窗口大小, 这称为接收窗口rwnd, 即调整TCP报文段首部中的"窗口"字段值, 来限制发送方向网络注入报文的速率. 同时发送方根据其对当前网络拥塞程序的估计而确定的窗口值, 称为拥塞窗口cwnd, 其大小与网络的带宽和时延密切相关. 

传输层与数据链路层的流量控制的区别是: 传输层定义端到端用户之间的流量控制, 数据链路层定义两个蹭的相邻结点的流量控制. 另外, 数据链路层的滑动 窗口不能动态变化.

- TCP的拥塞控制

所谓拥塞控制, 是指防止过多的数据注入网络, 以使网络中的路由器或链路不致过载. 

拥塞控制与流量控制的相同在于, 都通过控制发送方发送数据的速率来达到控制效果. 区别在于拥塞控制是让网络能够承受现有的网络负荷, 是一个全局性的过程, 涉及所有的主机, 所有的路由器, 以及与降低网络传输性能有关的所有因互. 而流量控制往往是指点对点的通信量的控制, 即接收端控制发送端. 

为了更好的对传输层进行拥塞控制, 因特网建议标准定义了4种算法: 慢开始, 拥塞避免, 快重传, 快恢复

TCP协议要求发送方维护以下2个窗口: 

1. 接收窗口rwnd, 接收方根据目前接收缓存大小所许诺的最新窗口值, 反映接收方的容量, 由接收方根据其放在TCP报文的首部的窗口字段通知发送方.
2. 拥塞窗口cwnd, 发送方根据自己估算的网络拥塞程度而设置的窗口值, 反映网络的当前容量.

发送窗口为min(接收窗口, 拥塞窗口), 接收方总有足够大的缓存空间, 因而发送窗口的大小由网络的拥塞程序决定.

1. 慢开始算法

在TCP刚刚连接好并开始发送TCP报文段时, 先令拥塞窗口cwnd=1, 即一个最大报文段长度MSS. 每收到一个对新报文段的确认后, 将cwnd加1, 即增大一个MSS. 用这样的方法逐步增大发送方的拥塞窗口cwnd, 可使分组注入网络的速率更加合理.

每经过一个RTT, 拥塞窗口cwnd就会加倍, 增大到一个规定的慢开始(ssthreshold, 阈值)门限, 然后必胜拥塞避免算法.

2. 拥塞避免算法

拥塞避免算法是指, 发送端的拥塞窗口cwnd每经过一个RTT就增加一个MSS(最大报文段长度), 使cwnd按纯属规律缓慢增长, 而当出现一次超时时, 令慢开始门限(ssthreshold)等于当前cwnd的一半(即乘法减小).

网络拥塞处理:

当网络出现拥塞时, 无论是在慢开始阶段还是在拥塞避免阶段, 只要发送方检测到超时事件的发生(未按时收到确认, 重传计时器超时), 就要把慢开始门限(ssthreshold)设置为出现拥塞时的发送方的cwnd值的一半(但不能小于2), 然后把cwnd置为1, 执行慢开始算法. 这样做的目的是迅速减少主机发送到网络中的分组数, 使得发生拥塞的路由器有足够时间把队列中积压的分组处理完. 

快重传与快恢复算法是对慢开始和拥塞避免算法的改进

3. 快重传

快重传技术使用冗余ACK检测丢包的发生, 同样, 冗余ACK也用于网络拥塞的检测, 当发送方连续 收到三个重复的ACK报文时, 直接重传对方尚未收到的报文段, 而不必等待那个报文段设置的重传计时器超时.

4. 快恢复

发送端收到连续三个冗余ACK时, 执行乘法减小算法, 把慢开始门限设置为出现拥塞时发送方的cwnd的一半, 与慢开始算法(设置cwnd为1)的不同之处在于,它把cwnd设置为慢开始门限ssthreshold改变之后的数值, 然后执行拥塞避免算法(加法增加), 使拥塞窗口线性增大.

发送方的发送窗口的实际大小由流量控制和拥塞控制共同决定, min(rwnd, cwnd)

### 应用层

**网络应用模型**

- 客户/服务器模型

Client/Server, C/S模型中, 有一个总是打开的主机称为服务器, 它服务于许多来自其他称为客户机的主机请求. 其工作流程如下:

1. 服务器处于接收请求的状态.
2. 客户机发出服务请求, 并等待接收结果.
3. 服务器收到请求后, 分析请求, 进行必要的处理, 得到结果并发送给客户机.

典型应用: web(HTTP), 文件传输(FTP), 远程登录(TELNET)和电子邮件(SMTP)

其主要特点:

1. 网络中计算机的地位不平等.
2. 客户机相互之间不直接通信
3. 可拓展性不佳, 服务器支持的客户机数有限

- P2P2模型

不难看出, 在C/S模型中, 服务器性能的好坏决定了整个系统的性能, 当大量用户请求服务时, 服务器就必然成为系统的瓶颈. P2P模型的思想是整个网络中的传输内容不再保存在中心服务器上, 每个结点都具有下载, 上传功能, 其权利和义务都是大体对等的. 

在P2P模型中, 各计算机没有固定的客户和服务器划分. 相反, 任意一对计算机--称为对等方(Peer), 直接相互通信. 实际上, P2P模型从本质上来看仍然使用客户/服务器方式, 每个结点既作为客户访问其他结点的资源, 也作为服务器提供资源给其他结点访问. 如PPlive, Bittorrent, 电驴等

与客户/服务器模型相比, P2P模型的优点主要体现如下:

1. 减轻了服务器的计算压力, 消除了对某个服务器的完全依赖, 可以将任务分配到各个结点上, 因此大大提高了系统效率和资源利用率.
2. 多个客户机之间可以直接共享文档.
3. 可拓展性好, 传统服务器有响应和带宽的限制, 因此只能接受一定数量的请求.
4. 网络健壮性强, 单个结点的失效不会影响其他部分的结点.

P2P模型也有缺点, 在获取服务的同时, 还要给其他结点提供服务, 因此会战胜较多的内在, 影响整机的速度.

**域名系统**

域名系统(Domain Name System, DNS)是因特网使用的命名系统, 用来把便于人们记忆的具有特定含义的主机名转换为便于机器处理的IP地址. DNS系统采用客户/服务器模型, 其协议运行在UDP之上, 使用53号端口.

从概念上可将DNS分为3部分: 层次域名空间, 域名服务器和解析器

- 层次域名空间

顶级域, 二级域, 三级域. 如www.cskaoyan.com, 标号com是顶级域名, 标号cskaoyan是二级域名, 标号com是三级域名.

关于域名有几点需要注意:

1. 标号中的英文不区分大小写.
2. 桔中除连字符 `-`外不能使用其他的标点符号.
3. 每个标号不超过63个字符, 多标号组成的完整域名最长不超过255个字符.
4. 级别最低的域名写在最左边

顶级域名的划分:

1. 国家顶级域名

如, .cn 中国, .us 美国

2. 通用顶级域名

如, .com 公司, .net网络服务机构, .org 非营利性组织, .gov 美国政府部门

3. 基础结构域名

只有一个arpa, 用于反射域名解析, 又称反向域名.

- 域名服务器

因特网的域名系统被设计成一个联机分布式的数据库系统, 并采用客户/服务器模型. 域名到ID地址的解析是由运行在域名服务器上的程序完成的. 没有一台域名服务器具有因循网上所有主机的映射, 该映射分布在所有的DNS上. DNS是在因特网上实现分布式数据库的精彩范例.

主要分4种类型的域名服务器

1. 根域名服务器
2. 顶级域名服务器
3. 授权域名服务器(权限域名服务器)
4. 本地域名服务器

- 域名解析

域名解析是指把域名映射成为IP地址, 称为正向解析, 或把IP地址映射为域名的过程, 称为反向解析

域名解析有2种方式, 递归查询和递归与迭代相结合的查询, 实际上前者几乎不用.

**文件传输协议(FTP)**

- FTP的工作原理

文件传输协议(File Transfer Protocol, FTP)是因特网上使用得最广泛的文件传输协议, FTP提供交互式的访问, 允许客户指明文件的类型与格式, 并允许文件具有存取权限. FTP提供以下功能:

1. 提供不同各类主机系统(硬, 软件体系等都可以不同)之间的文件传输能力. 
2. 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力.
3. 以匿名FTP的方式提供公用文件共享的能力.

FTP采用C/S模型, 使用TCP可靠的传输服务. 一个FTP服务器 进程可同时为多个客户进程提供服务. FTP的服务器进程由2大部分组成: 一个主进程, 负责接收亲的请求. 另外有若干人从属进程, 负责处理单个请求. 其工作步骤如下:

1. 打开熟知端口21(控制商品), 使客户进程能够连接上
2. 等待客户进程发连接请求
3. 启动从属进程来处理客户进程发来的请求. 主进程与从属进程并发执行, 从属进程对客户进程的请求处理完毕后即终止.
4. 回到等待状态, 继续接收其它客户进程的请求. 

FTP服务器必须在整个会话期间保留用户的状态信息. 特别是服务器必须把指定的用户账户与控制连接联系起来,服务器必须贫嘴用户在远程目录树上的当前位置.

- 控制连接与数据连接

1. 控制连接

监听21端口, 不用来传送文件, 在整个会话期间保持打开状态

2. 数据连接

20端口, 传送完毕后关闭.

使用FTP时, 若要修改服务器上的文件, 则需要先将此文件传送到本地主机, 然后再将修改后的文件副本传送到原服务器. 

网络文件系统(NFS)允许进程打开一个远程文件,并在该文件的某个特定位置开始读写数据, 这样, NFS可使用户复制一个大文件中的一个很小的片段, 而不需要复制整个大文件.

**电子邮件**

- 电子邮件系统的组成结构

电子邮件系统应具在三个最主要的组成构件: 

1. 用户代理(User Agent, UA)

一个运行在PC上的程序, 如Outlook, Foxmail

2. 邮件服务器

核心, 功能是发送和接收邮件, 同时还要向发信人报告邮件传送的情况. 采用C/S方式工作, 可以时充当客户和服务器.

3. 邮件发送协议和读取协议

邮件发送协议用于用户代理向邮件服务器发送邮件或在邮件服务器之间发送邮件, 通常使用SMTP;

邮件读取协议是用于用户代理从邮件服务器读取邮件, 如POP3.

- 电子邮件格式与MIME

1. 电子邮件格式

一个电子邮件分为信封和内容两大部分, 邮件内容又分为首部和主体2部分. From, To, Subject, Content

2. 多用途网际邮件扩充(MIME)

由于SMTP只能传送一定长度的ASCII码, 许多其他非英语国家的文字就无法传送, 且无法传送其它二进制对象, 因此有MIME.

MIME并未发动SMTP或取代它, MIME继续使用目前的格式, 但增加了邮件主体的结构, 并定义了传送非ASCII码的编码规则, MIME主要包括3部分内容:

1. 5个新的邮件首部字段, 包括MIME版本, 内容描述, 内容标识, 内容传送编码和内容类型.
2. 定义了许多邮件内容的格式, 对多媒体电子邮件的表示方法进行了标准化.
3. 定义了传送编码, 可以地任何内容格式进行转换, 而不会被邮件系统改变.

- SMTP 和 POP3

1. SMTP

简单邮件传输协议(Simple Mail Transfer Protocol, SMTP), 采用C/S模型, 使用TCP连接, 端口号25, 通信有3个阶段: 连接建立, 邮件传送, 连接释放

2. POP3

邮局协议(Post Office Protocol, POP), 采用C/S模型, 使用TCP连接, 端口号110, 2种工作模式: 下载并保留; 下载并删除.
